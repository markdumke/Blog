---
title: 'Intermingle R and Python in R Markdown'
author: Markus Dumke
date: '2017-11-09'
description: >
  Intermingle R and Python in R Markdown
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.align = 'center',
  fig.asp = 0.618, # 1 / phi
  out.width = "700px",
  message = FALSE,
  eval = FALSE
)
```

```{r crayon, include = FALSE}
colourise_chunk <- function(x, options) {
  x <- pkgdown:::escape_html(x)
  sprintf(
    '<div class = "output"><pre class="knitr %s">%s</pre></div>\n',
    tolower(options$engine),
    fansi::sgr_to_html(x)
  )
}
knitr::knit_hooks$set(
  output = colourise_chunk,
  message = colourise_chunk,
  warning = colourise_chunk,
  error = colourise_chunk
)

options(crayon.enabled = TRUE)
```

This blog post shows how to use R and Python inside one document and how to easily intermingle code, plain text and graphics and share data between R and Python.

## Why R Markdown?

R Markdown is great to make reproducible reports or presentations and allows to intermingle code, plain text and figures. It comes with a wide variety of output formats, e.g. pdf, html, word or latex beamer slides. You can even embed shiny apps in a html report. For example this document was generated with R Markdown.

In the following we will show how to combine R and Python code chunks inside one R Markdown document and how to share data between these chunks. Therefore R Markdown is a great tool for data scientists who wants to make the most out of the tools R and Python offer for data science.

## R code chunks

Using R code in R Markdown is easy:

```{r}
library(ggplot2)
head(iris)
ggplot(iris, aes(Sepal.Length, Sepal.Width, col = Species)) +
  geom_point(size = 3) + theme_bw()
```

## Python code chunks

We can also include Python code chunks. We will use `knitr::knit_engines$set(python = reticulate::eng_python)` in the setup to render the Python code. Make sure to install the newest `reticulate` package via `devtools::install_github("rstudio/reticulate")`.

```{python}
import numpy as np
x = np.arange(10)
y = x**2
```

And the objects are still available in the next Python chunk.

```{python}
print(y)
```

We can also include plots.

```{python}
import matplotlib.pyplot as plt
plt.plot(x, y)
plt.show()
```

## Share data between R and Python chunks

To share objects between Python and R chunks we need to save the files at the end of a chunk and load again in the next chunk. The best way to do this is probably [feather](https://blog.rstudio.com/2016/03/29/feather/).

Get the iris data set into Python using feather. First save it in an R chunk.

```{r}
library(feather)
write_feather(iris, "iris.feather")
```

Then we can load the file in a Python chunk.

```{python}
import feather
iris = feather.read_dataframe("iris.feather")
print(iris.head())
```

To share data frames from a Python chunk to an R chunk you can run

```{python}
import pandas as pd
d = {'col1': [1, 2, 6, 8], 'col2': ["first", "lab", "d", "car"]}
df = pd.DataFrame(data = d)
feather.write_dataframe(df, "df.feather")
print(df.head())
```

and load it in an R chunk with

```{r}
df <- read_feather("df.feather")
df
```
